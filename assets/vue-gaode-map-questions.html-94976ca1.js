import{_ as o,r as e,o as c,c as l,f as i,a as n,b as s,d as p,e as t}from"./app-2c72f79b.js";const u={},k=n("h1",{id:"vue-高德地图开发采坑持续记录-2019-06-25",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#vue-高德地图开发采坑持续记录-2019-06-25","aria-hidden":"true"},"#"),s(" vue+高德地图开发采坑持续记录[2019-06-25]")],-1),r=n("p",null,"整理了下日常地图开发过程中遇到的问题及解决方法，供大家参考，文章将会持续更新。",-1),d=t(`<h2 id="_1、地图引入问题" tabindex="-1"><a class="header-anchor" href="#_1、地图引入问题" aria-hidden="true">#</a> 1、地图引入问题</h2><p>网上搜索了一些资料，大部门都是 index.html 直接引入高德地图的 js 文件，个人感觉没有必要，毕竟地图只是部分页面需要使用，所以这种方法直接不考虑了。<br> 然后又找到了一种地图懒加载的方法，需要的时候按需引入地图即可。<br> 整理了下按需加载地图的 js，我们可以新建一个 js 文件，如<code>loadMap.js</code>,位置可以随意</p><p>这里为了引入方便直接放组件同级目录了，代码如下：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * 动态加载高德地图
 *
 * <span class="token keyword">@export</span>
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">key</span> 高德地图key
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">plugins</span> 高德地图插件
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>string<span class="token punctuation">}</span></span> <span class="token optional-parameter"><span class="token punctuation">[</span><span class="token parameter">v</span><span class="token punctuation">=</span><span class="token code language-javascript"><span class="token string">&#39;1.4.14&#39;</span></span><span class="token punctuation">]</span></span> 高德地图版本
 * <span class="token keyword">@returns</span>
 */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">loadMap</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> plugins<span class="token punctuation">,</span> v <span class="token operator">=</span> <span class="token string">&#39;1.4.14&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> AMap <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// eslint-disable-next-line no-undef</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>AMap<span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
    window<span class="token punctuation">.</span><span class="token function-variable function">onCallback</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// eslint-disable-next-line no-undef</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>AMap<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;script&#39;</span><span class="token punctuation">)</span>
    script<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">&#39;text/javascript&#39;</span>
    script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">https://webapi.amap.com/maps?v=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>v<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;key=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;plugin=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>plugins<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;callback=onCallback</span><span class="token template-punctuation string">\`</span></span>
    script<span class="token punctuation">.</span>onerror <span class="token operator">=</span> reject
    document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="使用" tabindex="-1"><a class="header-anchor" href="#使用" aria-hidden="true">#</a> 使用</h3><p>在需要用到的地方直接引用这个文件，再<code>mounted</code>的时候执行</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">loadMap</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>key<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>plugins<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>v<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">AMap</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 此处地图就加载成功了，然后就可以使用\`new AMap.Map\`来实例化地图了</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;地图加载成功！&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;地图加载失败！&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="完整代码" tabindex="-1"><a class="header-anchor" href="#完整代码" aria-hidden="true">#</a> 完整代码</h3><p>为了更好的体验，这里加了一个<code>loading</code>动画，地图加载成功<code>complete</code>后取消<code>loading</code>效果。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;map&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;GDMap&quot;</span>
      v<span class="token operator">-</span>loading<span class="token operator">=</span><span class="token string">&quot;loading&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">import</span> loadMap <span class="token keyword">from</span> <span class="token string">&#39;./loadMap&#39;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token comment">// 地图实例</span>
      <span class="token literal-property property">GDMap</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      <span class="token comment">// 加载的一些插件</span>
      <span class="token comment">// 更多参考：https://lbs.amap.com/api/javascript-api/guide/abc/plugins#plugins</span>
      <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&#39;AMap.OverView&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;AMap.MouseTool&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;AMap.PolyEditor&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;AMap.RectangleEditor&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;AMap.PlaceSearch&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;AMap.DistrictLayer&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;AMap.CustomLayer&#39;</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token comment">// key</span>
      <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;c5eac55551560531336988396dacbf53&#39;</span><span class="token punctuation">,</span>
      <span class="token comment">// 地图版本</span>
      <span class="token literal-property property">v</span><span class="token operator">:</span> <span class="token string">&#39;1.4.14&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">loading</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">loadMap</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>key<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>plugins<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>v<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">AMap</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>Map</span><span class="token punctuation">(</span><span class="token string">&#39;GDMap&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">zoom</span><span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
          <span class="token literal-property property">center</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">116.397428</span><span class="token punctuation">,</span> <span class="token number">39.90923</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;complete&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;地图加载失败！&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
#GDMap <span class="token punctuation">{</span>
  <span class="token literal-property property">width</span><span class="token operator">:</span> 1200px<span class="token punctuation">;</span>
  <span class="token literal-property property">height</span><span class="token operator">:</span> 500px<span class="token punctuation">;</span>
    <span class="token literal-property property">position</span><span class="token operator">:</span> relative<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="预览" tabindex="-1"><a class="header-anchor" href="#预览" aria-hidden="true">#</a> 预览</h3>`,11),v=n("iframe",{width:"100%",height:"500",src:"//jsrun.pro/8sbKp/embedded/all/light/",allowfullscreen:"allowfullscreen",frameborder:"0"},null,-1),m=n("h2",{id:"_2、获取多边形编辑的点的问题",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_2、获取多边形编辑的点的问题","aria-hidden":"true"},"#"),s(" 2、获取多边形编辑的点的问题")],-1),b=n("br",null,null,-1),y={href:"https://lbs.amap.com/api/javascript-api/reference/plugin#AMap.PolyEditor",target:"_blank",rel:"noopener noreferrer"},g=n("br",null,null,-1),h=n("br",null,null,-1),w=n("br",null,null,-1),f=n("code",null,"change",-1),P=n("br",null,null,-1),M=t(`<h3 id="核心代码" tabindex="-1"><a class="header-anchor" href="#核心代码" aria-hidden="true">#</a> 核心代码</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 多边形的path</span>
<span class="token keyword">let</span> polygonPath <span class="token operator">=</span> polygon<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 索引</span>
<span class="token keyword">let</span> index
<span class="token comment">// change事件</span>
polygon<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;change&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> curPath <span class="token operator">=</span> ev<span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> path<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 判断一直在变化的点</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>polygonPath<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>lng <span class="token operator">!==</span> curPath<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>lng <span class="token operator">||</span> polygonPath<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>lat <span class="token operator">!==</span> curPath<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>lat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      index <span class="token operator">=</span> i
      <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  polygonPath <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>curPath<span class="token punctuation">)</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;编辑点索引：&#39;</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="完整代码-1" tabindex="-1"><a class="header-anchor" href="#完整代码-1" aria-hidden="true">#</a> 完整代码</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;map&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;GDMap&quot;</span>
      v<span class="token operator">-</span>loading<span class="token operator">=</span><span class="token string">&quot;loading&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
 
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">import</span> loadMap <span class="token keyword">from</span> <span class="token string">&#39;./loadMap&#39;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token comment">// 地图实例</span>
      <span class="token literal-property property">GDMap</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      <span class="token comment">// 加载的插件</span>
      <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&#39;AMap.OverView&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;AMap.MouseTool&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;AMap.PolyEditor&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;AMap.RectangleEditor&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;AMap.PlaceSearch&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;AMap.DistrictLayer&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;AMap.CustomLayer&#39;</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token comment">// key</span>
      <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;c5eac55551560531336988396dacbf53&#39;</span><span class="token punctuation">,</span>
      <span class="token comment">// 地图版本</span>
      <span class="token literal-property property">v</span><span class="token operator">:</span> <span class="token string">&#39;1.4.14&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">loading</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">loadMap</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>key<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>plugins<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>v<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">AMap</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>Map</span><span class="token punctuation">(</span><span class="token string">&#39;GDMap&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">zoom</span><span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
          <span class="token literal-property property">center</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">116.397428</span><span class="token punctuation">,</span> <span class="token number">39.90923</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;complete&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
 
        <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token punctuation">[</span>
          <span class="token punctuation">[</span><span class="token number">116.403322</span><span class="token punctuation">,</span> <span class="token number">39.920255</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">[</span><span class="token number">116.410703</span><span class="token punctuation">,</span> <span class="token number">39.897555</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">[</span><span class="token number">116.402292</span><span class="token punctuation">,</span> <span class="token number">39.892353</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">[</span><span class="token number">116.389846</span><span class="token punctuation">,</span> <span class="token number">39.891365</span><span class="token punctuation">]</span>
        <span class="token punctuation">]</span>
        <span class="token keyword">const</span> polygon <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>Polygon</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">,</span>
          <span class="token literal-property property">strokeColor</span><span class="token operator">:</span> <span class="token string">&#39;#FF33FF&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">strokeWeight</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
          <span class="token literal-property property">strokeOpacity</span><span class="token operator">:</span> <span class="token number">0.2</span><span class="token punctuation">,</span>
          <span class="token literal-property property">fillOpacity</span><span class="token operator">:</span> <span class="token number">0.4</span><span class="token punctuation">,</span>
          <span class="token literal-property property">fillColor</span><span class="token operator">:</span> <span class="token string">&#39;#1791fc&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">zIndex</span><span class="token operator">:</span> <span class="token number">50</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// 地图添加多边形</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>polygon<span class="token punctuation">)</span>
        <span class="token comment">// 缩放地图到合适的视野级别</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">setFitView</span><span class="token punctuation">(</span><span class="token punctuation">[</span> polygon <span class="token punctuation">]</span><span class="token punctuation">)</span>
 
        <span class="token comment">// 多边形编辑实例</span>
        <span class="token keyword">const</span> polyEditor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>PolyEditor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">,</span> polygon<span class="token punctuation">)</span>
        <span class="token comment">// 开启编辑</span>
        polyEditor<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 
        <span class="token comment">// 多边形的path</span>
        <span class="token keyword">let</span> polygonPath <span class="token operator">=</span> polygon<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// 索引</span>
        <span class="token keyword">let</span> index
        <span class="token comment">// change事件</span>
        polygon<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;change&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> curPath <span class="token operator">=</span> ev<span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> path<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 判断一直在变化的点</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>polygonPath<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>lng <span class="token operator">!==</span> curPath<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>lng <span class="token operator">||</span> polygonPath<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>lat <span class="token operator">!==</span> curPath<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>lat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              index <span class="token operator">=</span> i
              <span class="token keyword">break</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
          polygonPath <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>curPath<span class="token punctuation">)</span><span class="token punctuation">)</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;编辑点索引：&#39;</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;地图加载失败！&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
 
<span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
#GDMap <span class="token punctuation">{</span>
  <span class="token literal-property property">width</span><span class="token operator">:</span> 1200px<span class="token punctuation">;</span>
  <span class="token literal-property property">height</span><span class="token operator">:</span> 500px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="效果图" tabindex="-1"><a class="header-anchor" href="#效果图" aria-hidden="true">#</a> 效果图</h3><figure><img src="https://image.liubing.me/2019/12/26/1993a054121e3.gif" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><h2 id="_3、信息窗口使用问题" tabindex="-1"><a class="header-anchor" href="#_3、信息窗口使用问题" aria-hidden="true">#</a> 3、信息窗口使用问题</h2>`,7),x={href:"https://lbs.amap.com/api/javascript-api/example/infowindow/default-style-infowindow",target:"_blank",rel:"noopener noreferrer"},G=t(`<figure><img src="https://image.liubing.me/2019/12/26/3efb240dfb6a3.png" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><figure><img src="https://image.liubing.me/2019/12/26/5c9bc35add80c.png" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><p>要是按照这种写法，vue中相关事件及数据传递怎么整，后期维护还很困难，<br> 所以这种形式直接被我pass掉了，自己写一个类似的组件，放在地图上不就行了吧，自由程度高，可定制化也高。</p><h3 id="简单的信息窗口组件" tabindex="-1"><a class="header-anchor" href="#简单的信息窗口组件" aria-hidden="true">#</a> 简单的信息窗口组件</h3><p>自定义了一个简单的信息窗口组件<code>InfoWindow</code>，显示出来后大致就长这个样子，UI样式可以自己定义，所以很方便。</p><figure><img src="https://image.liubing.me/2019/12/26/100561490126f.png" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><h3 id="组件代码" tabindex="-1"><a class="header-anchor" href="#组件代码" aria-hidden="true">#</a> 组件代码</h3><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>GDMap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>info-window</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>info-window</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
 
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>info-window<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>top<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>标题<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>close<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>x<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>content<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      我是窗口的内容
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
 
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.info-window</span> <span class="token punctuation">{</span>
  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token property">top</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
  <span class="token property">min-width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
  <span class="token property">border-radius</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>
  <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 1px 2px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> #ffffff<span class="token punctuation">;</span>
  <span class="token property">z-index</span><span class="token punctuation">:</span> 10<span class="token punctuation">;</span>
  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>-50%<span class="token punctuation">,</span> -50%<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.info-window::after</span> <span class="token punctuation">{</span>
  <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">&quot;◆&quot;</span><span class="token punctuation">;</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 36px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 24px<span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> #ffffff<span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>-50%<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token selector">.info-window .top</span> <span class="token punctuation">{</span>
  <span class="token property">padding-bottom</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
  <span class="token property">justify-content</span><span class="token punctuation">:</span> space-between<span class="token punctuation">;</span>
  <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token selector">.info-window .top .title</span> <span class="token punctuation">{</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token selector">.info-window .top .close</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 24px<span class="token punctuation">;</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span>
  <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="窗口位置" tabindex="-1"><a class="header-anchor" href="#窗口位置" aria-hidden="true">#</a> 窗口位置</h3><p>这是官网信息窗口在地图拖拽过程中的表现，会发现一直固定在某一个点相对位置</p><figure><img src="https://image.liubing.me/2019/12/26/69baa6cdaf57f.gif" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><p>再看看我们写的信息窗口组件，看到差异了吧，信息窗口被固定死了。</p><figure><img src="https://image.liubing.me/2019/12/26/665c32c0b0c4c.gif" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><p>通过审核元素你会发现官方的信息窗口的位置随着地图的拖拽在实时变化。</p><figure><img src="https://image.liubing.me/2019/12/26/ed2d397ba9c3d.gif" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><p>所以加下来我们要做的就是这个。<br> 看了下文档，找到了地图的一个方法<code>lngLatToContainer</code>，<br> 官方给出的描述是：<code>地图经纬度坐标转为地图容器像素坐标</code>，<br> 实际上窗口信息在地图上显示靠的是一个坐标点，有了这个坐标点信息窗口才知道需要哪个位置进行显示，<br> 对于信息窗口组件来说这个坐标点就是<code>absolute</code>定位中的<code>top</code>和<code>left</code>，对于地图来讲就是<code>lng</code>和<code>lat</code>经纬度，<br> 所以先定一个地图的坐标点，<code>pos: [116.397428, 39.90923]</code>，该坐标也是地图初始化时候的中心点坐标<code>(center)</code>，<br> 地图拖动过程中会触发<code>mapmove</code>事件，在该事件中，通过<code>lngLatToContainer</code>方法获取到<code>pos</code>点在地图容器的实时像素坐标，然后实时改变组件的<code>top</code>和<code>left</code>即可达到效果。</p><h4 id="相关代码" tabindex="-1"><a class="header-anchor" href="#相关代码" aria-hidden="true">#</a> 相关代码</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;mapmove&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> position <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">lngLatToContainer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pos<span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>infoWindow<span class="token punctuation">.</span>$el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> position<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token string">&#39;px&#39;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>infoWindow<span class="token punctuation">.</span>$el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> position<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token string">&#39;px&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="预览-1" tabindex="-1"><a class="header-anchor" href="#预览-1" aria-hidden="true">#</a> 预览</h4><p>这样就差不多和官方的信息窗口差不多了。</p><figure><img src="https://image.liubing.me/2019/12/26/9f3459d6cc9ec.gif" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><h3 id="代码完善" tabindex="-1"><a class="header-anchor" href="#代码完善" aria-hidden="true">#</a> 代码完善</h3><p>接下来我们将代码稍微完善以下，增加一个新功能，点击地图上的热点的时候，出现信息窗口，显示相应热点的信息。</p><h4 id="代码" tabindex="-1"><a class="header-anchor" href="#代码" aria-hidden="true">#</a> 代码</h4><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>map<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>GDMap<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">v-loading</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>loading<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>info-window</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>visible<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">:pos</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>position<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">:info</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>info<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">@close</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>visible = false<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>info-window</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> loadMap <span class="token keyword">from</span> <span class="token string">&#39;./loadMap&#39;</span>
<span class="token keyword">import</span> InfoWindow <span class="token keyword">from</span> <span class="token string">&#39;./InfoWindow&#39;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    InfoWindow
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token comment">// 地图实例</span>
      <span class="token literal-property property">GDMap</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      <span class="token comment">// 加载的插件</span>
      <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&#39;AMap.OverView&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;AMap.MouseTool&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;AMap.PolyEditor&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;AMap.RectangleEditor&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;AMap.PlaceSearch&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;AMap.DistrictLayer&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;AMap.CustomLayer&#39;</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token comment">// key</span>
      <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;c5eac55551560531336988396dacbf53&#39;</span><span class="token punctuation">,</span>
      <span class="token comment">// 地图版本</span>
      <span class="token literal-property property">v</span><span class="token operator">:</span> <span class="token string">&#39;1.4.14&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">loading</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">pos</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">116.397428</span><span class="token punctuation">,</span> <span class="token number">39.90923</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">visible</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">info</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">loadMap</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>key<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>plugins<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>v<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">AMap</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>Map</span><span class="token punctuation">(</span><span class="token string">&#39;GDMap&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">zoom</span><span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
          <span class="token literal-property property">center</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">116.397428</span><span class="token punctuation">,</span> <span class="token number">39.90923</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
 
        <span class="token comment">// 地图加载完成事件</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;complete&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
 
        <span class="token comment">// 热点点击事件</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;hotspotclick&#39;</span><span class="token punctuation">,</span> <span class="token parameter">ev</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>visible <span class="token operator">=</span> <span class="token boolean">true</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>pos <span class="token operator">=</span> <span class="token punctuation">[</span>ev<span class="token punctuation">.</span>lnglat<span class="token punctuation">.</span>lng<span class="token punctuation">,</span> ev<span class="token punctuation">.</span>lnglat<span class="token punctuation">.</span>lat<span class="token punctuation">]</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>info <span class="token operator">=</span> ev
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;地图加载失败！&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">mapmove</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">lngLatToContainer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pos<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">pos</span> <span class="token punctuation">(</span><span class="token parameter">newPos</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">lngLatToContainer</span><span class="token punctuation">(</span>newPos<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">visible</span> <span class="token punctuation">(</span><span class="token parameter">newVisible</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newVisible<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 绑定地图平移事件</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;mapmove&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mapmove<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// 移除事件绑定</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">&#39;mapmove&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mapmove<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">#GDMap</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 1200px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 500px<span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="信息窗口组件" tabindex="-1"><a class="header-anchor" href="#信息窗口组件" aria-hidden="true">#</a> 信息窗口组件</h4><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>info-window<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>infoWindow<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>top<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{ { info.name }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>close<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleClose<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>x<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>content<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      id：{ { info.id }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
      type:{ { info.type }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
      lnglat：{ { info.lnglat.lng }},{ { info.lnglat.lat }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>footer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      by: liubing.me
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 像素坐标</span>
    <span class="token literal-property property">pos</span><span class="token operator">:</span> Object<span class="token punctuation">,</span>
    <span class="token comment">// 窗口信息</span>
    <span class="token literal-property property">info</span><span class="token operator">:</span> Object<span class="token punctuation">,</span>
    <span class="token comment">// 信息窗口偏移</span>
    <span class="token literal-property property">offset</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> Object<span class="token punctuation">,</span>
      <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
          <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">handleClose</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&#39;close&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">pos</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">handler</span> <span class="token punctuation">(</span><span class="token parameter">newPos</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newPos <span class="token operator">&amp;&amp;</span> newPos<span class="token punctuation">.</span>x <span class="token operator">&amp;&amp;</span> newPos<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> infoHeight <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;.info-window&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>clientHeight
            <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>infoWindow<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> newPos<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>offset<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token string">&#39;px&#39;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>infoWindow<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> newPos<span class="token punctuation">.</span>y <span class="token operator">-</span> infoHeight <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>offset<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token string">&#39;px&#39;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">immediate</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.info-window</span> <span class="token punctuation">{</span>
  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token property">top</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
  <span class="token property">min-width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
  <span class="token property">border-radius</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>
  <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 1px 2px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> #ffffff<span class="token punctuation">;</span>
  <span class="token property">z-index</span><span class="token punctuation">:</span> 10<span class="token punctuation">;</span>
  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>-50%<span class="token punctuation">,</span> -50%<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.info-window::after</span> <span class="token punctuation">{</span>
  <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">&quot;◆&quot;</span><span class="token punctuation">;</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 36px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 24px<span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> #ffffff<span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>-50%<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token selector">.info-window .top</span> <span class="token punctuation">{</span>
  <span class="token property">padding-bottom</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
  <span class="token property">justify-content</span><span class="token punctuation">:</span> space-between<span class="token punctuation">;</span>
  <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token selector">.info-window .top .title</span> <span class="token punctuation">{</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token selector">.info-window .top .close</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 24px<span class="token punctuation">;</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span>
  <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.info-window .content</span> <span class="token punctuation">{</span>
  <span class="token property">text-align</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.info-window .footer</span> <span class="token punctuation">{</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> #cccccc<span class="token punctuation">;</span>
  <span class="token property">text-align</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="最终预览" tabindex="-1"><a class="header-anchor" href="#最终预览" aria-hidden="true">#</a> 最终预览</h3><p>最后，大家可以根据这个法子自定义出自己的信息窗口组件，而不用受高德地图信息窗口的约束了。</p><figure><img src="https://image.liubing.me/2019/12/26/8771fc2890b7e.gif" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><h2 id="_4、多边形绘制边缘自动吸附" tabindex="-1"><a class="header-anchor" href="#_4、多边形绘制边缘自动吸附" aria-hidden="true">#</a> 4、多边形绘制边缘自动吸附</h2><p>由于高德自带的绘制工具提供的事件太少，目前就一个<code>draw</code>事件，<br> 完全不满足我的需求，所以自力更生自己实现一个多边形绘制，大致思路如下：<br> 1、点击绘制按钮，将鼠标变成十字架<br> 2、通过地图的<code>click</code>事件，每点击一次用<code>new AMap.CircleMarker</code>生成一个圆点<br> 3、根据所生成的圆点坐标生成一个多边形</p><h3 id="自定义多边形绘制" tabindex="-1"><a class="header-anchor" href="#自定义多边形绘制" aria-hidden="true">#</a> 自定义多边形绘制</h3><h4 id="定义数据" tabindex="-1"><a class="header-anchor" href="#定义数据" aria-hidden="true">#</a> 定义数据</h4><p>先在<code>data</code>中定义一些我们需要的变量数据</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token literal-property property">isDrawing</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否正在绘制</span>
<span class="token literal-property property">polygons</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 多边形集合数据</span>
<span class="token literal-property property">polygonsGroup</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 多边形OverlayGroup集合实例，方便管理</span>
<span class="token literal-property property">drawingPolygon</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">polyline</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 绘制过程中的折线实例</span>
  <span class="token literal-property property">polylinePath</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 折线的path</span>
  <span class="token literal-property property">polygon</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 根据折线路径自动生成的多边形的实例</span>
  <span class="token literal-property property">pointsGroup</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 绘制过程中点的集合的实例</span>
  <span class="token literal-property property">pointOnLine</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 多边形边上的点的实例</span>
  <span class="token literal-property property">isOnPolygon</span><span class="token operator">:</span> <span class="token keyword">null</span> <span class="token comment">// 点是否在多边形上</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// 一些样式</span>
<span class="token literal-property property">styles</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token comment">// 圆点样式option</span>
  <span class="token literal-property property">circleMarker</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">radius</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
    <span class="token literal-property property">strokeColor</span><span class="token operator">:</span> <span class="token string">&#39;#010301&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">strokeWeight</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token literal-property property">strokeOpacity</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">fillColor</span><span class="token operator">:</span> <span class="token string">&#39;#FFFFFF&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">fillOpacity</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">bubble</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">cursor</span><span class="token operator">:</span> <span class="token string">&#39;pointer&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">clickable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">zIndex</span><span class="token operator">:</span> <span class="token number">999999</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 绘制过程中折线样式的option</span>
  <span class="token literal-property property">drawingPolyline</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">strokeColor</span><span class="token operator">:</span> <span class="token string">&#39;#dd9ab0&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">strokeWeight</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token literal-property property">strokeStyle</span><span class="token operator">:</span> <span class="token string">&#39;dashed&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">strokeDasharray</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">bubble</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="点击地图生成圆点" tabindex="-1"><a class="header-anchor" href="#点击地图生成圆点" aria-hidden="true">#</a> 点击地图生成圆点</h4><p>点击相应的绘制按钮后，点击地图生成一个个圆点，到时候利用这些圆点生成多边形。<br> 先增加个地图点击事件及相应的处理方法：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 地图点击事件</span>
<span class="token function">mapOnClick</span><span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isDrawing<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">let</span> position <span class="token operator">=</span> <span class="token punctuation">[</span>ev<span class="token punctuation">.</span>lnglat<span class="token punctuation">.</span>lng<span class="token punctuation">,</span> ev<span class="token punctuation">.</span>lnglat<span class="token punctuation">.</span>lat<span class="token punctuation">]</span> <span class="token comment">// 鼠标点击的坐标</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addPolygonPoint</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span> <span class="token comment">// 地图上增加相应的点</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// 添加围成多边形的点</span>
<span class="token function">addPolygonPoint</span><span class="token punctuation">(</span><span class="token parameter">position</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 样式及坐标option</span>
  <span class="token keyword">const</span> option <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>styles<span class="token punctuation">.</span>circleMarker<span class="token punctuation">,</span>
    <span class="token literal-property property">center</span><span class="token operator">:</span> position
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> circlePointMarker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>CircleMarker</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span> <span class="token comment">// 单个圆点实例</span>
  <span class="token comment">// 先判断是否存在圆点集合实例，不存在话就创建一个</span>
  <span class="token comment">// 所有的圆点这里通过高德提供的OverlayGroup统一管理</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>pointsGroup<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果不存在</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>pointsGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>OverlayGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 创建绘制过程中点的集合的实例</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>pointsGroup<span class="token punctuation">)</span> <span class="token comment">// 将集合添加到地图上显示</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>pointsGroup<span class="token punctuation">.</span><span class="token function">addOverlay</span><span class="token punctuation">(</span>circlePointMarker<span class="token punctuation">)</span> <span class="token comment">// 将点添加到集合里面</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>效果图：</p><figure><img src="https://image.liubing.me/2019/12/26/6b012489b4e0c.gif" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><h4 id="生成绘制过程中的鼠标移动位置的折线" tabindex="-1"><a class="header-anchor" href="#生成绘制过程中的鼠标移动位置的折线" aria-hidden="true">#</a> 生成绘制过程中的鼠标移动位置的折线</h4><p>绘制点击生成圆点的同时新增绘制过程中的折线</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 新增绘制中的折线</span>
<span class="token function">addDrawingPolyline</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 判断有无折线</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polyline<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polyline<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token comment">// 有的话直接设置折线路径</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// 没有的话需要创建折线</span>
    <span class="token comment">// 折线样式及路径</span>
    <span class="token keyword">const</span> option <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>styles<span class="token punctuation">.</span>drawingPolyline<span class="token punctuation">,</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> path
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polyline <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>Polyline</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span> <span class="token comment">// 生成折线</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polyline<span class="token punctuation">)</span> <span class="token comment">// 地图上添加折线</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polylinePath <span class="token operator">=</span> path <span class="token comment">// 存一下折线的路径</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>鼠标移动过程中实时改变绘制过程中的折线路径</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 地图鼠标移动事件</span>
<span class="token function">mapOnMouseMove</span><span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isDrawing<span class="token punctuation">)</span> <span class="token keyword">return</span>
  <span class="token keyword">const</span> position <span class="token operator">=</span> <span class="token punctuation">[</span>ev<span class="token punctuation">.</span>lnglat<span class="token punctuation">.</span>lng<span class="token punctuation">,</span> ev<span class="token punctuation">.</span>lnglat<span class="token punctuation">.</span>lat<span class="token punctuation">]</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setDrawingPolyline</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
 
<span class="token comment">// 设置绘制中的折线的路径</span>
<span class="token function">setDrawingPolyline</span> <span class="token punctuation">(</span><span class="token parameter">position</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polyline<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 新增的折线的路径，由上次记录折线的开始点+鼠标坐标位置点</span>
    <span class="token keyword">const</span> linePath <span class="token operator">=</span> <span class="token punctuation">[</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polylinePath<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 上次记录折线的开始点</span>
      position <span class="token comment">// 鼠标坐标位置点</span>
    <span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polyline<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span>linePath<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polylinePath <span class="token operator">=</span> linePath
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>效果图：</p><figure><img src="https://image.liubing.me/2019/12/26/86a253cf45716.gif" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><h4 id="连接圆点形成实时多边形" tabindex="-1"><a class="header-anchor" href="#连接圆点形成实时多边形" aria-hidden="true">#</a> 连接圆点形成实时多边形</h4><p>根据上面的画点我们就可以组成一个多边形了，每次点击的都执行这个方法生成或者修改多边形的path</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">mapOnClick</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isDrawing<span class="token punctuation">)</span> <span class="token keyword">return</span>
  <span class="token keyword">let</span> position <span class="token operator">=</span> <span class="token punctuation">[</span>ev<span class="token punctuation">.</span>lnglat<span class="token punctuation">.</span>lng<span class="token punctuation">,</span> ev<span class="token punctuation">.</span>lnglat<span class="token punctuation">.</span>lat<span class="token punctuation">]</span> <span class="token comment">// 鼠标点击的坐标</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addPolygonPoint</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span> <span class="token comment">// 地图上增加相应的点</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addDrawingPolyline</span><span class="token punctuation">(</span><span class="token punctuation">[</span>position<span class="token punctuation">,</span> position<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 添加绘制过程中的鼠标移动位置的折线</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">drawPolygonByPoints</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 通过点围成多边形</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 根据点画区块多边形</span>
<span class="token function">drawPolygonByPoints</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> pointsGroup <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>pointsGroup
  <span class="token keyword">const</span> pointsLength <span class="token operator">=</span> pointsGroup <span class="token operator">?</span> pointsGroup<span class="token punctuation">.</span><span class="token function">getOverlays</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">:</span> <span class="token number">0</span>
 
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pointsLength <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> paths <span class="token operator">=</span> pointsGroup<span class="token punctuation">.</span><span class="token function">getOverlays</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> path <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getCenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span>lng<span class="token punctuation">,</span> path<span class="token punctuation">.</span>lat<span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polygon<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polygon<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span>paths<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> option <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>styles<span class="token punctuation">.</span>polygon<span class="token punctuation">,</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> paths
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polygon <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>Polygon</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polygon<span class="token punctuation">.</span><span class="token function">setMap</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>效果图：</p><figure><img src="https://image.liubing.me/2019/12/26/92db146e6ce62.gif" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><h4 id="双击绘制完成" tabindex="-1"><a class="header-anchor" href="#双击绘制完成" aria-hidden="true">#</a> 双击绘制完成</h4><p>通过高德提供的<code>dblclick</code>双击事件来执行<code>complateDraw</code>完成绘制，<br> 绘制完成的时候获取到<code>drawingPolygon</code>中<code>polygon</code>的path，将该path存起来，<br> 通过该path在地图上添加新绘制的多边形<br> 最后将之前的一些数据清理掉，准备下次的绘制。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 绘制完成</span>
<span class="token function">complateDraw</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> paths <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polygon<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>item<span class="token punctuation">.</span>lng<span class="token punctuation">,</span> item<span class="token punctuation">.</span>lat<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 绘制完成的多边形path</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>isDrawing <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">// 取消绘制</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>polygons<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>paths<span class="token punctuation">)</span> <span class="token comment">// 添加绘制的多边形</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addPolygon</span><span class="token punctuation">(</span>paths<span class="token punctuation">)</span> <span class="token comment">// 地图上添加绘制的多边形</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clearUselessOverlays</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 清理数据</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// 清理无用的图层</span>
<span class="token function">clearUselessOverlays</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">)</span> <span class="token keyword">return</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polyline<span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polygon<span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>pointsGroup<span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polyline <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polygon <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>pointsGroup <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polylinePath <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// 添加多边形</span>
<span class="token function">addPolygon</span> <span class="token punctuation">(</span><span class="token parameter">paths</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">)</span> <span class="token keyword">return</span>
  <span class="token keyword">const</span> option <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>styles<span class="token punctuation">.</span>polygon<span class="token punctuation">,</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> paths
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> polygon <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>Polygon</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>polygonsGroup<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>polygonsGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>OverlayGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>polygonsGroup<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>polygonsGroup<span class="token punctuation">.</span><span class="token function">addOverlay</span><span class="token punctuation">(</span>polygon<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>效果图：</p><figure><img src="https://image.liubing.me/2019/12/26/da145854d73b1.gif" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><h3 id="现有问题" tabindex="-1"><a class="header-anchor" href="#现有问题" aria-hidden="true">#</a> 现有问题</h3><p>上面实现了自定义的多边形绘制，但是存在一个问题，画图的时候虽然是对准这边缘画的，<br> 但是放大后会发现有缝隙或者重叠现象，如下图所示：</p><figure><img src="https://image.liubing.me/2019/12/26/65d55220c8719.gif" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><h3 id="线边缘自动吸附" tabindex="-1"><a class="header-anchor" href="#线边缘自动吸附" aria-hidden="true">#</a> 线边缘自动吸附</h3><p>说起来有点繁琐，有时间再写，先直接上完整代码，代码可能待优化，先实现功能：</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>map<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    { {this.polygons}}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>primary<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>drawPolygon<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>画多边形<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>GDMap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> loadMap <span class="token keyword">from</span> <span class="token string">&#39;./loadMap&#39;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token comment">// 地图实例</span>
      <span class="token literal-property property">GDMap</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      <span class="token comment">// 加载的一些插件</span>
      <span class="token comment">// 更多参考：https://lbs.amap.com/api/javascript-api/guide/abc/plugins#plugins</span>
      <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&#39;AMap.OverView&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;AMap.MouseTool&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;AMap.PolyEditor&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;AMap.RectangleEditor&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;AMap.PlaceSearch&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;AMap.DistrictLayer&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;AMap.CustomLayer&#39;</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token comment">// key</span>
      <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;c5eac55551560531336988396dacbf53&#39;</span><span class="token punctuation">,</span>
      <span class="token comment">// 地图版本</span>
      <span class="token literal-property property">v</span><span class="token operator">:</span> <span class="token string">&#39;1.4.14&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">loading</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token comment">// 多边形集合</span>
      <span class="token literal-property property">polygons</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">[</span>
          <span class="token punctuation">[</span> <span class="token number">116.402921</span><span class="token punctuation">,</span> <span class="token number">39.984507</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">[</span> <span class="token number">116.531324</span><span class="token punctuation">,</span> <span class="token number">39.938719</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">[</span> <span class="token number">116.525144</span><span class="token punctuation">,</span> <span class="token number">39.858648</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">[</span> <span class="token number">116.423521</span><span class="token punctuation">,</span> <span class="token number">39.821742</span> <span class="token punctuation">]</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">polygonsGroup</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 多边形OverlayGroup集合实例，方便管理</span>
      <span class="token literal-property property">isDrawing</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否正在绘制</span>
      <span class="token literal-property property">drawingPolygon</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">polyline</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 绘制过程中的折线实例</span>
        <span class="token literal-property property">polylinePath</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 折线的path</span>
        <span class="token literal-property property">polygon</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 根据折线路径自动生成的多边形的实例</span>
        <span class="token literal-property property">pointsGroup</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 绘制过程中点的集合的实例</span>
        <span class="token literal-property property">pointOnLine</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 多边形边上的点的实例</span>
        <span class="token literal-property property">isOnPolygon</span><span class="token operator">:</span> <span class="token keyword">null</span> <span class="token comment">// 点是否在多边形上</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">styles</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 圆点option</span>
        <span class="token literal-property property">circleMarker</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">radius</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
          <span class="token literal-property property">strokeColor</span><span class="token operator">:</span> <span class="token string">&#39;#010301&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">strokeWeight</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          <span class="token literal-property property">strokeOpacity</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
          <span class="token literal-property property">fillColor</span><span class="token operator">:</span> <span class="token string">&#39;#FFFFFF&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">fillOpacity</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
          <span class="token literal-property property">bubble</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token literal-property property">cursor</span><span class="token operator">:</span> <span class="token string">&#39;pointer&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">clickable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token literal-property property">zIndex</span><span class="token operator">:</span> <span class="token number">999999</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// 绘制过程中折线的option</span>
        <span class="token literal-property property">drawingPolyline</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">strokeColor</span><span class="token operator">:</span> <span class="token string">&#39;#dd9ab0&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">strokeWeight</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
          <span class="token literal-property property">strokeStyle</span><span class="token operator">:</span> <span class="token string">&#39;dashed&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">strokeDasharray</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token literal-property property">bubble</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">polygon</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">fillColor</span><span class="token operator">:</span> <span class="token string">&#39;#DC3021&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 填充色</span>
          <span class="token literal-property property">fillOpacity</span><span class="token operator">:</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token comment">// 填充透明度</span>
          <span class="token literal-property property">strokeColor</span><span class="token operator">:</span> <span class="token string">&#39;#DC3021&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 轮廓颜色</span>
          <span class="token literal-property property">strokeWeight</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 轮廓宽度</span>
          <span class="token literal-property property">strokeOpacity</span><span class="token operator">:</span> <span class="token number">0.9</span> <span class="token comment">// 轮廓透明度</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">loadMap</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>key<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>plugins<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>v<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">AMap</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>Map</span><span class="token punctuation">(</span><span class="token string">&#39;GDMap&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">zoom</span><span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
          <span class="token literal-property property">center</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">116.397428</span><span class="token punctuation">,</span> <span class="token number">39.90923</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token literal-property property">isHotspot</span><span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// 绑定地图单击事件</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mapOnClick<span class="token punctuation">)</span>
        <span class="token comment">// 地图双击事件</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;dblclick&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mapOnDblclick<span class="token punctuation">)</span>
        <span class="token comment">// 绑定地图鼠标移动事件</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;mousemove&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mapOnMouseMove<span class="token punctuation">)</span>
 
        <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;complete&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// 地图加载完成后初始化已有的多边形</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>polygons<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">polygon</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addPolygon</span><span class="token punctuation">(</span>polygon<span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;地图加载失败！&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">drawPolygon</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>isDrawing <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 地图点击事件</span>
    <span class="token function">mapOnClick</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isDrawing<span class="token punctuation">)</span> <span class="token keyword">return</span>
      <span class="token keyword">let</span> position <span class="token operator">=</span> <span class="token punctuation">[</span>ev<span class="token punctuation">.</span>lnglat<span class="token punctuation">.</span>lng<span class="token punctuation">,</span> ev<span class="token punctuation">.</span>lnglat<span class="token punctuation">.</span>lat<span class="token punctuation">]</span> <span class="token comment">// 鼠标点击的坐标</span>
      <span class="token comment">// 判断是否存在存在线上圆点实例及是否在线上</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>isOnPolygon <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>pointOnLine<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> center <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>pointOnLine<span class="token punctuation">.</span><span class="token function">getCenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 获取线上圆点的中心</span>
        position <span class="token operator">=</span> <span class="token punctuation">[</span>center<span class="token punctuation">.</span>lng<span class="token punctuation">,</span> center<span class="token punctuation">.</span>lat<span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addPolygonPoint</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span> <span class="token comment">// 地图上增加相应的点</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addDrawingPolyline</span><span class="token punctuation">(</span><span class="token punctuation">[</span>position<span class="token punctuation">,</span> position<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 添加绘制过程中的鼠标移动位置的折线</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">drawPolygonByPoints</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 通过点围成多边形</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 地图双击事件</span>
    <span class="token function">mapOnDblclick</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isDrawing<span class="token punctuation">)</span> <span class="token keyword">return</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">complateDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 地图鼠标移动事件</span>
    <span class="token function">mapOnMouseMove</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isDrawing<span class="token punctuation">)</span> <span class="token keyword">return</span>
      <span class="token keyword">const</span> position <span class="token operator">=</span> <span class="token punctuation">[</span>ev<span class="token punctuation">.</span>lnglat<span class="token punctuation">.</span>lng<span class="token punctuation">,</span> ev<span class="token punctuation">.</span>lnglat<span class="token punctuation">.</span>lat<span class="token punctuation">]</span>
      <span class="token keyword">const</span> linePath <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getPointLine</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span> <span class="token comment">// 获取点所在的线</span>
      <span class="token keyword">let</span> recentPoint <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token comment">// 定义最近的点</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>isOnPolygon<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果点在线上（这个点存在偏移，所以还得通过getRecentPoint获取到正在的最近的一个点）</span>
        <span class="token comment">// 获取该点到线的最近的一个点</span>
        recentPoint <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRecentPoint</span><span class="token punctuation">(</span>linePath<span class="token punctuation">,</span> position<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addDrawingOnLinePoint</span><span class="token punctuation">(</span>recentPoint<span class="token punctuation">)</span> <span class="token comment">// 在线上添加圆点，也就是自动吸附的时候创建的点</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">removeDrawingOnLinePoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setDrawingPolyline</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 添加围成多边形的点</span>
    <span class="token function">addPolygonPoint</span> <span class="token punctuation">(</span><span class="token parameter">position</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 样式及坐标option</span>
      <span class="token keyword">const</span> option <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>styles<span class="token punctuation">.</span>circleMarker<span class="token punctuation">,</span>
        <span class="token literal-property property">center</span><span class="token operator">:</span> position
      <span class="token punctuation">}</span>
      <span class="token keyword">const</span> circlePointMarker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>CircleMarker</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span> <span class="token comment">// 单个圆点实例</span>
      <span class="token comment">// 先判断是否存在圆点集合实例</span>
      <span class="token comment">// 所有的圆点这里通过高德提供的OverlayGroup统一管理</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>pointsGroup<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果不存在</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>pointsGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>OverlayGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 创建绘制过程中点的集合的实例</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>pointsGroup<span class="token punctuation">)</span> <span class="token comment">// 将集合添加到地图上显示</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>pointsGroup<span class="token punctuation">.</span><span class="token function">addOverlay</span><span class="token punctuation">(</span>circlePointMarker<span class="token punctuation">)</span> <span class="token comment">// 将点添加到集合里面</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 新增绘制中的折线</span>
    <span class="token function">addDrawingPolyline</span> <span class="token punctuation">(</span><span class="token parameter">paths</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 判断有无折线</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polyline<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polyline<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span>paths<span class="token punctuation">)</span> <span class="token comment">// 有的话直接设置折线路径</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// 没有的话需要创建折线</span>
        <span class="token comment">// 折线样式及路径</span>
        <span class="token keyword">const</span> option <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>styles<span class="token punctuation">.</span>drawingPolyline<span class="token punctuation">,</span>
          <span class="token literal-property property">path</span><span class="token operator">:</span> paths
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polyline <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>Polyline</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span> <span class="token comment">// 生成折线</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polyline<span class="token punctuation">)</span> <span class="token comment">// 地图上添加折线</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polylinePath <span class="token operator">=</span> paths <span class="token comment">// 存一下折线的路径</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 设置绘制中的折线的路径</span>
    <span class="token function">setDrawingPolyline</span> <span class="token punctuation">(</span><span class="token parameter">position</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polyline<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 新增的折线的路径，由上次记录折线的开始点+鼠标坐标位置点</span>
        <span class="token keyword">const</span> linePath <span class="token operator">=</span> <span class="token punctuation">[</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polylinePath<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 上次记录折线的开始点</span>
          position <span class="token comment">// 鼠标坐标位置点</span>
        <span class="token punctuation">]</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polyline<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span>linePath<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polylinePath <span class="token operator">=</span> linePath
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 根据点画区块多边形</span>
    <span class="token function">drawPolygonByPoints</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> pointsGroup <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>pointsGroup <span class="token comment">// 点及的集合实例</span>
      <span class="token keyword">const</span> pointsLength <span class="token operator">=</span> pointsGroup <span class="token operator">?</span> pointsGroup<span class="token punctuation">.</span><span class="token function">getOverlays</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">:</span> <span class="token number">0</span> <span class="token comment">// 点的长度</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>pointsLength <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取每个点的中心点组成path</span>
        <span class="token keyword">const</span> paths <span class="token operator">=</span> pointsGroup<span class="token punctuation">.</span><span class="token function">getOverlays</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> path <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getCenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span>lng<span class="token punctuation">,</span> path<span class="token punctuation">.</span>lat<span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// 地图上绘制多边形</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polygon<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polygon<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span>paths<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> option <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>styles<span class="token punctuation">.</span>polygon<span class="token punctuation">,</span>
            <span class="token literal-property property">path</span><span class="token operator">:</span> paths
          <span class="token punctuation">}</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polygon <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>Polygon</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polygon<span class="token punctuation">.</span><span class="token function">setMap</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 绘制完成</span>
    <span class="token function">complateDraw</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> paths <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polygon<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>item<span class="token punctuation">.</span>lng<span class="token punctuation">,</span> item<span class="token punctuation">.</span>lat<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 绘制完成的多边形path</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>isDrawing <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">// 取消绘制</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>polygons<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>paths<span class="token punctuation">)</span> <span class="token comment">// 添加绘制的多边形</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addPolygon</span><span class="token punctuation">(</span>paths<span class="token punctuation">)</span> <span class="token comment">// 地图上添加绘制的多边形</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clearUselessOverlays</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 清理数据</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 清理无用的图层</span>
    <span class="token function">clearUselessOverlays</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">)</span> <span class="token keyword">return</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polyline<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polygon<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>pointsGroup<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>pointOnLine<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>pointOnLine<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polyline <span class="token operator">=</span> <span class="token keyword">null</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polygon <span class="token operator">=</span> <span class="token keyword">null</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>pointsGroup <span class="token operator">=</span> <span class="token keyword">null</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>polylinePath <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>isOnPolygon <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 添加多边形</span>
    <span class="token function">addPolygon</span> <span class="token punctuation">(</span><span class="token parameter">paths</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">)</span> <span class="token keyword">return</span>
      <span class="token keyword">const</span> option <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>styles<span class="token punctuation">.</span>polygon<span class="token punctuation">,</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>paths<span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">const</span> polygon <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>Polygon</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>polygonsGroup<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>polygonsGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>OverlayGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>polygonsGroup<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>polygonsGroup<span class="token punctuation">.</span><span class="token function">addOverlay</span><span class="token punctuation">(</span>polygon<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 添加多边形边线上的点</span>
    <span class="token function">addDrawingOnLinePoint</span> <span class="token punctuation">(</span><span class="token parameter">center</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>pointOnLine<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>pointOnLine<span class="token punctuation">.</span><span class="token function">setCenter</span><span class="token punctuation">(</span>center<span class="token punctuation">)</span>
        <span class="token keyword">return</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">const</span> option <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">map</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">,</span>
        <span class="token literal-property property">center</span><span class="token operator">:</span> center<span class="token punctuation">,</span>
        <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>styles<span class="token punctuation">.</span>circleMarker
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>pointOnLine <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>CircleMarker</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 移除多边形线上的点</span>
    <span class="token function">removeDrawingOnLinePoint</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>pointOnLine<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>pointOnLine<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>pointOnLine <span class="token operator">=</span> <span class="token keyword">null</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 获取点所在的线</span>
    <span class="token function">getPointLine</span> <span class="token punctuation">(</span><span class="token parameter">position</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> resolution <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">getResolution</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 获取指定位置的地图分辨率，单位：米/像素</span>
      <span class="token keyword">const</span> pointWidth <span class="token operator">=</span> <span class="token number">6</span> <span class="token operator">*</span> resolution<span class="token comment">// 线段上圆点的宽度，也就是误差</span>
      <span class="token keyword">let</span> linePath <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>isOnPolygon <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">// 默认点不在线上</span>
      <span class="token comment">// 循环所有的多边形，取到所有的线一一比较，存在性能问题</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>polygons<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> itemPath <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>polygons<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token keyword">let</span> hasFind <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> n <span class="token operator">&lt;</span> itemPath<span class="token punctuation">.</span>length<span class="token punctuation">;</span> n<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> path <span class="token operator">=</span> itemPath<span class="token punctuation">[</span>n<span class="token punctuation">]</span>
          <span class="token keyword">const</span> nextPath <span class="token operator">=</span> itemPath<span class="token punctuation">[</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span>
          <span class="token keyword">const</span> line <span class="token operator">=</span> nextPath <span class="token operator">?</span> <span class="token punctuation">[</span>path<span class="token punctuation">,</span> nextPath<span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">,</span> itemPath<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
          <span class="token comment">// 高德地图提供的isPointOnSegment判断点是否在线段上</span>
          <span class="token keyword">const</span> isPointOnSegment <span class="token operator">=</span> AMap<span class="token punctuation">.</span>GeometryUtil<span class="token punctuation">.</span><span class="token function">isPointOnSegment</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> line<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> line<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pointWidth<span class="token punctuation">)</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>isPointOnSegment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            linePath <span class="token operator">=</span> line
            <span class="token keyword">this</span><span class="token punctuation">.</span>drawingPolygon<span class="token punctuation">.</span>isOnPolygon <span class="token operator">=</span> <span class="token boolean">true</span>
            hasFind <span class="token operator">=</span> <span class="token boolean">true</span>
            <span class="token keyword">break</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>hasFind<span class="token punctuation">)</span> <span class="token keyword">break</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> linePath
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 获取最近的点的坐标</span>
    <span class="token function">getRecentPoint</span> <span class="token punctuation">(</span><span class="token parameter">paths<span class="token punctuation">,</span> curPointPosition</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> recentPoint <span class="token operator">=</span> AMap<span class="token punctuation">.</span>GeometryUtil<span class="token punctuation">.</span><span class="token function">closestOnLine</span><span class="token punctuation">(</span>curPointPosition<span class="token punctuation">,</span> paths<span class="token punctuation">)</span>
      <span class="token keyword">return</span> recentPoint
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">isDrawing</span> <span class="token punctuation">(</span><span class="token parameter">newState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>newState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">setDefaultCursor</span><span class="token punctuation">(</span><span class="token string">&#39;crosshair&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">setDefaultCursor</span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>GDMap<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">doubleClickZoom</span><span class="token operator">:</span> <span class="token operator">!</span>newState
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">#GDMap</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 1200px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 500px<span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="最终效果图" tabindex="-1"><a class="header-anchor" href="#最终效果图" aria-hidden="true">#</a> 最终效果图</h3><p>这样画出的来的多边形边缘就不会存在缝隙或者重叠的现象了。</p><figure><img src="https://image.liubing.me/2019/12/26/771d4092263db.gif" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><figure><img src="https://image.liubing.me/2019/12/26/d33b4c532c831.gif" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><h3 id="在线预览" tabindex="-1"><a class="header-anchor" href="#在线预览" aria-hidden="true">#</a> 在线预览</h3>`,70),D=n("iframe",{width:"100%",height:"500",src:"//jsrun.net/jdyKp/embedded/all/light/",allowfullscreen:"allowfullscreen",frameborder:"0"},`
`,-1),q=n("br",null,null,-1),O=n("code",null,"openlayers",-1),_=n("br",null,null,-1),j={href:"https://github.com/liub1934/vue-openlayers",target:"_blank",rel:"noopener noreferrer"},A=n("br",null,null,-1),C={href:"https://github.liubing.me/vue-openlayers",target:"_blank",rel:"noopener noreferrer"};function L(z,F){const a=e("ExternalLinkIcon");return c(),l("div",null,[k,r,i(" more "),d,v,m,n("p",null,[s("说的直白点，就是多边形在拖动点编辑过程中知道是哪个点"),b,s(" 看了下官网的相关文档："),n("a",y,[s("https://lbs.amap.com/api/javascript-api/reference/plugin#AMap.PolyEditor"),p(a)]),g,s(" 没找到相关的api，无奈只能自己写了。"),h,s(" 大致思路就是多边形在编辑过程中其他的点的坐标是不变了，唯一变化的就是被编辑的点，在编辑过程中做个判断即可找到这个点的索引。"),w,s(" 多边形在被编辑过程中是会触发"),f,s("事件，所以可以利用这个事件写些判断，"),P,s(" 在拿到这个点的索引后我们就可以干点其他事情了。")]),M,n("p",null,[s("看了下官网信息窗口的相关"),n("a",x,[s("例子"),p(a)]),s("，发现写法都不太友好，例如以下几种形式的写法：")]),G,D,n("blockquote",null,[n("p",null,[s("所画的多边形编辑过程中线边缘自动吸附暂时没想到什么法子，"),q,s(" 高德提供的方法太少，目前已经更换为开源的地图"),O,s("实现了，"),_,s(" Github："),n("a",j,[s("https://github.com/liub1934/vue-openlayers"),p(a)]),A,s(" Demo预览："),n("a",C,[s("https://github.liubing.me/vue-openlayers"),p(a)])])])])}const E=o(u,[["render",L],["__file","vue-gaode-map-questions.html.vue"]]);export{E as default};
